---
layout: default
---

## Windows Malware Scanner

This was my first coding project, and is a basic file-based 'malware scanner'. The idea is to automate a very simple scanner for Windows Operating systems using Python. In short, the algorith reads a list of known malware names (specifically '.exe' files) from a '.csv' file, compiles these into a malware signature list, and scans the local computerâ€™s file system for matching '.exe' files. Any matches are flagged as potential threats and logged in an output '.txt' file. To run the algorithm in devices that do not have Python installed, I created an '.exe' file using PyInstaller that is also stored at it's [GitHub repository](https://github.com/Rafael-Santamaria-Ortega/Malware_Detection_Algorithm).

I am aware that this is a very basic algorithm with many shortcomings, such as: 

1. The unreliability of using file names to detect malware. Furthermore, not every malware is a '.exe' file, as even fileless malware exists. 

2. The amount of false positives derived from '.exe' malicious files trying to masquarade as legitimate files.

3. The lack of independance from the '.csv' database.

In the future I plan to address each point by either transforming this simple Python code into a Deep Learning model that can "learn" to identify more malware characteristics to predict very accurately if the scanned files of all types are possible malware; even if there is no database present, as the model would already trained and ready to deploy. 

Anyway, here is a break down of the main code: 

```python
import csv

convlist = list()
unique_exes = set()
```

*1. Imports*: 
1.1. The csv Python module is imported to read the .csv database of malware names. 

*2. Initializations*: 
2.1 Two empty data structures are initialized: 'convlist': A list to temporarily store .exe file names found in the .csv file; 'unique_exes:' A set to ensure only unique .exe names are kept.

```python
print('Reading and parsing .csv database...')

with open('full.csv', mode='r', encoding='utf-8') as file:
    csvfh = csv.DictReader(file, fieldnames=['F'])
    for row in csvfh:
        exe_position = row['F'].find('.exe')
        data = row['F'][:exe_position + 4]
        if exe_position == -1:
            continue
        else:
            convlist.append(data)
    
    for line in convlist:
        exe = line.rsplit('"', 1)[-1].strip()
        unique_exes.add(exe)
```

*3. CSV Parsing and Malware Extraction:* 

3.1. Opens and reads 'full.csv', where each row contains potential file paths or names;

3.2 Checks each row to see if it contains an '.exe' file. If so, extracts the '.exe' filename and appends it to 'convlist';

3.3 After reading all rows, iterates through 'convlist', extracts the last section (the actual filename) after the last double quote ("), and adds it to 'unique_exes' to ensure all entries are unique.

```python
print('Threat names identified!')

print('Extracting them in a txt file...')

convlist2 = list(unique_exes)
with open('newlistmalware.txt', 'w', encoding='utf-8') as output_file:
    output_file.write(",".join(convlist2))

print('Results extracted to newlistmalware.txt')
```

*4. Writing Unique Malware Names to a Text File:*

4.1. Converts 'unique_exes' set to a list ('convlist2') and writes all entries to 'newlistmalware.txt', separated by commas.

4.2. This file now contains the known malware names that will be used in the scanning phase.

```python
print('All done!')

import os

path = 'C:/'
pathfinder = os.fsencode(path)

print('Scanning computer...')

exelist = list()
for dirpath, dirnames, filenames in os.walk(path):
    for fname in filenames:
        if fname.endswith('.exe'):
            exelist.append(fname)
```

*5. Computer Scan for Executables:*

5.1 Sets the scanning root directory as 'C:/' and uses 'os.walk' to iterate through all directories and files.
5.2 Appends each '.exe' file found to 'exelist'. This list represents all executables on the local machine that will be compared with known malware.

```python
print('Computer scan finished!')

print('Comparing results to known malware database...')

threatlist = set()
with open('newlistmalware.txt', 'r', encoding='utf-8') as file:
    for line in file:
        for item in exelist:
            if item in line:
                threatlist.add(item)
                # count += 1
```

*6. Threat Comparison:*

6.1. Reads 'newlistmalware.txt', which contains known malware names.
6.2. For each executable in 'exelist', checks if it is mentioned in the known malware list ('newlistmalware.txt'). If it matches, it is added to 'threatlist'.

```python
count = len(threatlist)
print('Possible threats found:', count)
```

*7. Threat Count Display:*

7.1. Counts the number of unique matches (potential threats) in 'threatlist' and displays the count to the user.

```python
print('Printing possible threats in a txt file!')

with open('Possiblethreats.txt', 'w', encoding='utf-8') as lst:
    lst.write(f'Total possible threats:{count}\n')
    for exe in threatlist:
        lst.write(exe + '\n')
    # lst.write('\n'.join(threatlist))

print('Possible threats txt printed!')
print('All done!')
```

*8. Output of Results:* 

8.1. Writes the total threat count and list of flagged executables to Possiblethreats.txt, creating a record of all identified threats.
8.1 Signals completion to the user.

[back](./)
